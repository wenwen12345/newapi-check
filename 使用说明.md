# 每日兑换码系统 - 快速使用指南

## 一键启动

```bash
chmod +x setup.sh
./setup.sh
```

## 手动步骤

### 1. 安装依赖
```bash
uv sync
```

### 2. 配置环境变量
```bash
cp .env.example .env
# 编辑 .env 文件，填入你的 OAuth2 凭据
```

### 3. 初始化数据库
```bash
uv run python init_db.py
```

### 4. 导入兑换码

#### 方式一：生成测试兑换码
```bash
uv run python generate_test_codes.py
```

#### 方式二：从文件导入
创建 `codes.txt` 文件，每行一个兑换码：
```
CODE-ABC123
CODE-DEF456
CODE-GHI789
```

然后导入：
```bash
uv run python import_codes.py codes.txt
```

### 5. 启动应用
```bash
uv run python main.py
```

## 使用流程

1. 打开浏览器访问 `http://localhost:8181`
2. 点击"使用 Linux.do 登录"
3. 完成 OAuth2 认证
4. 自动跳转到兑换码页面
5. 点击"领取今日兑换码"

## 核心功能

### ✅ 自动化体验
- 登录后自动跳转，无需手动输入 token
- 自动获取和显示用户信息
- 自动加载领取历史

### ✅ 每日限制
- 每个用户每天只能领取一次
- 按自然日（00:00:00 - 23:59:59）计算

### ✅ 兑换码管理
- 支持批量导入兑换码
- 自动检测重复兑换码
- 记录完整的兑换历史

## API 端点

### 领取兑换码
```bash
POST /api/redeem/daily?access_token=YOUR_TOKEN
```

### 查看历史
```bash
GET /api/redeem/history?access_token=YOUR_TOKEN
```

## 数据库

- 数据库文件：`redeem_codes.db`
- 表结构：
  - `redeem_codes`: 兑换码表
  - `user_redeem_records`: 用户兑换记录表

## 常见问题

### Q: 如何添加更多兑换码？
A: 运行 `uv run python import_codes.py codes.txt` 或 `uv run python generate_test_codes.py`

### Q: 如何重置每日限制？
A: 等到第二天自动重置，或手动删除数据库中的记录

### Q: 数据库在哪里？
A: 项目根目录下的 `redeem_codes.db` 文件

### Q: 如何查看剩余兑换码？
A: 可以使用 SQLite 工具打开 `redeem_codes.db` 查看，或编写查询脚本

## 文件说明

| 文件 | 说明 |
|------|------|
| `main.py` | FastAPI 主应用 |
| `models.py` | 数据库模型 |
| `database.py` | 数据库配置 |
| `init_db.py` | 数据库初始化 |
| `import_codes.py` | 兑换码导入工具 |
| `generate_test_codes.py` | 生成测试兑换码 |
| `setup.sh` | 一键安装脚本 |

## 技术特点

- 🚀 FastAPI - 高性能异步框架
- 🗄️ SQLModel + SQLite - 轻量级 ORM
- 🔐 OAuth2 - Linux.do 认证
- 🎨 纯 HTML/CSS/JS - 无需前端框架
- ⚡ 异步数据库操作 - 高并发支持

## 下一步

查看详细文档：
- [完整项目文档](./README.md)
- [兑换码功能详解](./REDEEM_CODES_README.md)

祝使用愉快！🎉
